<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SinePatre â€” Resource Navigator</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;600;700&display=swap');

    :root {
      --bg-dark: #242424;
      --text-primary: #ffffff;
      --text-secondary: #a0a0a0;
      --accent-blue: #2d4a8f;
      --accent-blue-hover: #223861;
      --border-soft: rgba(255,255,255,0.08);
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'EB Garamond', Georgia, serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      letter-spacing: -0.005em;
      line-height: 1.6;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 820px;
      padding: 48px 24px;
      text-align: center;
    }

    .header {
      margin-bottom: 48px;
    }

    .title-with-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 14px;
      margin-bottom: 20px;
    }

    .icon {
      width: 44px;
      height: 44px;
      border-radius: 7px;
      background: var(--accent-blue);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      font-weight: 600;
    }

    h1 {
      margin: 0;
      font-weight: 500;
      font-size: clamp(40px, 6vw, 56px);
      line-height: 1.1;
      letter-spacing: -0.015em;
      color: var(--text-primary);
    }

    .description {
      margin: 20px 0 0 0;
      color: var(--text-secondary);
      font-size: 15px;
      line-height: 1.8;
      max-width: 680px;
      margin-left: auto;
      margin-right: auto;
    }

    .composer-wrap {
      width: 100%;
    }

    .input-bar {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border-soft);
      border-radius: 20px;
      padding: 13px 16px;
      transition: all 0.2s ease;
    }

    .input-bar:focus-within {
      border-color: rgba(45, 74, 143, 0.4);
      background: rgba(255,255,255,0.06);
    }

    textarea {
      width: 100%;
      border: none;
      outline: none;
      background: transparent;
      color: var(--text-primary);
      font-family: 'EB Garamond', Georgia, serif;
      font-size: 16px;
      line-height: 1.5;
      resize: none;
      min-height: 22px;
      max-height: 100px;
      padding: 4px 0;
      font-weight: 400;
    }

    textarea::placeholder {
      color: var(--text-secondary);
      font-weight: 400;
    }

    .btn {
      width: 38px;
      height: 38px;
      border-radius: 9px;
      border: 1px solid var(--border-soft);
      background: var(--accent-blue);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      flex-shrink: 0;
      padding: 0;
    }

    .btn:hover:not(:disabled) {
      background: var(--accent-blue-hover);
      border-color: rgba(45, 74, 143, 0.5);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn svg {
      width: 16px;
      height: 16px;
      stroke: currentColor;
      stroke-width: 2.2;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .messages {
      display: none;
      flex-direction: column;
      gap: 14px;
      margin-top: 36px;
      max-height: 450px;
      overflow-y: auto;
    }

    .messages.active {
      display: flex;
    }

    .msg-row {
      display: flex;
      animation: slideIn 0.3s ease-out;
    }

    .msg-row.user {
      justify-content: flex-end;
    }

    @keyframes slideIn {
      from { 
        opacity: 0; 
        transform: translateY(4px); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }

    .bubble {
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-width: 520px;
    }

    .msg-text {
      padding: 11px 15px;
      border-radius: 14px;
      font-size: 15px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .msg-text.user {
      background: var(--accent-blue);
      color: white;
    }

    .msg-text.assistant {
      background: rgba(255,255,255,0.06);
      color: var(--text-primary);
    }

    @media (max-width: 640px) {
      h1 { 
        font-size: 36px; 
      }
      .container {
        padding: 32px 16px;
      }
    }

    ::-webkit-scrollbar {
      width: 5px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.08);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255,255,255,0.12);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title-with-icon">
        <div class="icon">SP</div>
        <h1>SinePatre</h1>
      </div>
      <p class="description">
        A private guide designed for fatherless teens seeking support. Curated from a vetted database of resources, SinePatre listens to your situation and delivers personalized recommendations grounded in real organizations and practical next steps. Whether you're navigating grief, seeking mentorship, managing school stress, or processing identity questions, you'll find pathways forward that fit your life.
      </p>
    </div>

    <div class="composer-wrap">
      <div class="input-bar" role="group" aria-label="Message composer">
        <textarea
          id="input"
          placeholder="What do you need help with?"
          rows="1"
          autocomplete="off"
          spellcheck="true"
        ></textarea>
        <button id="send-btn" class="btn" title="Send message">
          <svg viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </button>
      </div>
    </div>

    <main id="messages" class="messages" aria-live="polite" aria-label="Chat messages"></main>
  </div>

  <script>
    const messagesEl = document.getElementById('messages');
    const inputEl = document.getElementById('input');
    const sendBtn = document.getElementById('send-btn');

    let history = [];

    function autoGrowTextarea() {
      inputEl.style.height = 'auto';
      inputEl.style.height = Math.min(inputEl.scrollHeight, 100) + 'px';
    }

    function addMessage(role, content) {
      messagesEl.classList.add('active');
      
      const row = document.createElement('div');
      row.className = `msg-row ${role}`;
      
      const bubble = document.createElement('div');
      bubble.className = `bubble ${role}`;
      
      const text = document.createElement('div');
      text.className = `msg-text ${role}`;
      text.textContent = content;
      
      bubble.appendChild(text);
      row.appendChild(bubble);
      messagesEl.appendChild(row);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    async function send() {
      const msg = inputEl.value.trim();
      if (!msg) return;
      
      addMessage('user', msg);
      inputEl.value = '';
      inputEl.style.height = 'auto';
      sendBtn.disabled = true;
      
      history.push({ role: 'user', content: msg });
      
      try {
        const res = await fetch('/api/navigate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: msg, history }),
        });
        
        const data = await res.json();
        
        if (data.error) {
          addMessage('assistant', `Error: ${data.error}`);
        } else {
          addMessage('assistant', data.intro);
          history.push({ role: 'assistant', content: data.intro });
        }
      } catch (err) {
        addMessage('assistant', 'Connection error. Please try again.');
      }
      
      sendBtn.disabled = false;
      inputEl.focus();
    }

    inputEl.addEventListener('input', autoGrowTextarea);
    inputEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        send();
      }
    });

    sendBtn.addEventListener('click', send);
    autoGrowTextarea();
    inputEl.focus();
  </script>
</body>
</html>
